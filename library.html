---
layout: strudel
title: library
permalink: /library/
---

<div id="json">
  <div class="my ms">
    <span class="key">"library"</span>: <span class="value">"<a href="{{ '/' | relative_url }}">back to home</a>"</span>,
  </div>
  <div class="my ms">
    <span class="key">"tracks"</span>: [
  </div>
</div>

<div id="tracks-list"></div>

<div id="json">
  <div class="my ms">
    ]
  </div>
</div>

<script type="module">
  // List your track files here
  const tracks = [
    { file: 'track01.txt', title: 'first try', date: '12/2/25' },
    { file: 'track02.txt', title: 'test', date: '12/3/25' },
    // Add more tracks here as you create them
  ];

  const tracksList = document.getElementById('tracks-list');
  const strudelInstances = {}; // Track loaded instances

  for (let i = 0; i < tracks.length; i++) {
    const track = tracks[i];
    const trackId = `track-${i}`;
    
    // Create track entry in JSON style
    const trackEntry = document.createElement('div');
    trackEntry.className = 'my ms';
    trackEntry.innerHTML = `
      <div class="ms">
        {
        <div class="ms">
          <span class="key">"title"</span>: <span class="value">"${track.title}"</span>,<br>
          <span class="key">"date"</span>: <span class="value">"${track.date}"</span>,<br>
          <span class="key">"play"</span>: <span class="value"><a href="#" id="play-${trackId}" style="color: var(--oc-green-5);">"click to load"</a></span>
        </div>
        }${i < tracks.length - 1 ? ',' : ''}
      </div>
    `;
    tracksList.appendChild(trackEntry);
    
    // Create container for Strudel player (hidden initially)
    const strudelContainer = document.createElement('div');
    strudelContainer.id = `strudel-${trackId}`;
    strudelContainer.style.display = 'none';
    strudelContainer.style.marginBottom = '30px';
    tracksList.appendChild(strudelContainer);
    
    // Add click handler
    document.getElementById(`play-${trackId}`).addEventListener('click', async (e) => {
      e.preventDefault();
      
      const container = document.getElementById(`strudel-${trackId}`);
      const link = e.target;
      
      // If already loaded, toggle visibility and stop audio when hiding
      if (container.innerHTML !== '') {
        if (container.style.display === 'none') {
          container.style.display = 'block';
          link.textContent = '"hide player"';
        } else {
          // Hide and try to stop audio
          container.style.display = 'none';
          link.textContent = '"click to load"';
          
          // Try to stop the audio by removing and recreating the element
          const oldRepl = container.querySelector('strudel-repl');
          if (oldRepl) {
            oldRepl.remove();
            strudelInstances[trackId] = null;
          }
        }
        return;
      }
      
      // Load the track for the first time
      try {
        const url = `{{ "/assets/tracks/" | relative_url }}${track.file}`;
        const response = await fetch(url);
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const code = await response.text();
        const strudelRepl = document.createElement('strudel-repl');
        strudelRepl.setAttribute('code', code);
        
        container.appendChild(strudelRepl);
        strudelInstances[trackId] = strudelRepl;
        container.style.display = 'block';
        link.textContent = '"hide player"';
        
      } catch (error) {
        console.error(`Error loading ${track.file}:`, error);
        container.innerHTML = `<p style="color: red;">Error loading track</p>`;
        container.style.display = 'block';
      }
    });
  }
</script>
